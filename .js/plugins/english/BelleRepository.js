var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("cheerio"),a=require("@libs/defaultCover"),i=require("@libs/novelStatus"),o=function(){function o(){var t=this;this.id="bellerepository",this.name="Belle Repository",this.icon="src/en/bellerepository/mainducky.png",this.site="https://bellerepository.com/",this.version="1.0.0",this.resolveUrl=function(e,r){return e.startsWith("http")?e:t.site+e.replace(/^\//,"")}}return o.prototype.popularNovels=function(i,o){return t(this,arguments,void 0,(function(t,i){var o,s,c,u,l,h,f=this;i.showLatestNovels;return e(this,(function(i){switch(i.label){case 0:o=["".concat(this.site,"page/").concat(t,"/"),"".concat(this.site),"".concat(this.site,"?paged=").concat(t)],s=function(t){var i,o,s,c,u;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,r.fetchApi)(t).then((function(t){return t.text()}))];case 1:if(!(i=e.sent())||""===i.trim())return[2,"continue"];for(o=(0,n.load)(i),s=[],c=0,u=[".c-blog__content",".post-title a",".item-thumb a",'a[href*="/novel/"]',"h3 a","h2 a","article a"];c<u.length;c++)o(u[c]).each((function(t,e){var r=o(e).attr("href")?o(e):o(e).find("a").first(),n=r.text().trim()||r.find("h1, h2, h3, h4, h5, h6").text().trim()||r.attr("title"),i=r.attr("href");if(n&&i&&i.includes("novel")){var c=a.defaultCover,u=o(e).find("img").first();u.length&&(c=u.attr("data-src")||u.attr("src")||u.attr("data-lazy-src")||a.defaultCover),s.push({name:n,cover:c,path:i.replace(f.site,"/")})}}));return s.length>0?[2,{value:s.slice(0,20)}]:[3,3];case 2:return e.sent(),[2,"continue"];case 3:return[2]}}))},c=0,u=o,i.label=1;case 1:return c<u.length?(l=u[c],[5,s(l)]):[3,4];case 2:if("object"==typeof(h=i.sent()))return[2,h.value];i.label=3;case 3:return c++,[3,1];case 4:return[2,[]]}}))}))},o.prototype.parseNovel=function(o){return t(this,void 0,void 0,(function(){var t,s,c,u,l,h,f,p,v,d,m=this;return e(this,(function(e){switch(e.label){case 0:return t=this.site+o,[4,(0,r.fetchApi)(t).then((function(t){return t.text()}))];case 1:for(s=e.sent(),c=(0,n.load)(s),u={path:o,name:c("h1.post-title").text().trim()||""},l=c(".summary_image img"),u.cover=l.attr("data-src")||l.attr("src")||a.defaultCover,c(".post-content_item").each((function(t,e){var r=c(e).find("h5").text().trim(),n=c(e).find(".summary-content").text().trim();switch(r){case"Author":u.author=n;break;case"Status":u.status=n.toLowerCase().includes("ongoing")?i.NovelStatus.Ongoing:i.NovelStatus.Completed;break;case"Genre":case"Genres":u.genres=c(e).find(".summary-content a").map((function(t,e){return c(e).text()})).get().join(", ")}})),u.summary=c(".summary__content").text().trim()||"",h=[],f=!1,p=0,v=[".wp-manga-chapter",".listing-chapters li",".chapter-item","ul.chapters li"];p<v.length;p++)if(c(d=v[p]).length>0){f=!0,c(d).each((function(t,e){var r=c(e).find("a").text().trim(),n=c(e).find("a").attr("href"),a=c(e).find(".chapter-release-date").text().trim();r&&n&&h.push({name:r,path:n.replace(m.site,"/"),releaseTime:a||null,chapterNumber:t+1})}));break}return f||c('a[href*="chapter"]').each((function(t,e){var r=c(e).text().trim(),n=c(e).attr("href");r&&n&&r.toLowerCase().includes("chapter")&&h.push({name:r,path:n.replace(m.site,"/"),releaseTime:null,chapterNumber:t+1})})),u.chapters=h.reverse(),[2,u]}}))}))},o.prototype.parseChapter=function(a){return t(this,void 0,void 0,(function(){var t,i,o,s,c,u;return e(this,(function(e){switch(e.label){case 0:return t=this.site+a,[4,(0,r.fetchApi)(t).then((function(t){return t.text()}))];case 1:for(i=e.sent(),o=(0,n.load)(i),s=0,c=[".entry-content",".text-left",".text-right",".c-blog-post > div > div:nth-child(2)",".reading-content",".chapter-content",".post-content"];s<c.length;s++)if((u=o(c[s])).length>0)return u.find("script, style, .ads, .advertisement, .nav-next, .nav-prev, .chapter-nav").remove(),[2,u.html()||""];return[2,o("body").html()||""]}}))}))},o.prototype.searchNovels=function(i,o){return t(this,void 0,void 0,(function(){var t,s,c,u,l,h,f=this;return e(this,(function(p){switch(p.label){case 0:t=["".concat(this.site,"?s=").concat(encodeURIComponent(i),"&post_type=wp-manga"),"".concat(this.site,"?s=").concat(encodeURIComponent(i)),"".concat(this.site,"search/").concat(encodeURIComponent(i),"/")],s=function(t){var o,s,c,u,l;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,r.fetchApi)(t).then((function(t){return t.text()}))];case 1:if(!(o=e.sent())||""===o.trim())return[2,"continue"];for(s=(0,n.load)(o),c=[],u=0,l=[".c-blog__content a",".post-title a",".item-thumb a",'a[href*="/novel/"]',"h3 a","h2 a"];u<l.length;u++)s(l[u]).each((function(t,e){var r=s(e).attr("href")?s(e):s(e).find("a").first(),n=r.text().trim()||r.find("h1, h2, h3").text().trim()||r.attr("title"),o=r.attr("href");if(n&&o&&o.includes("novel")&&n.toLowerCase().includes(i.toLowerCase())){var u=a.defaultCover,l=s(e).find("img").first();l.length&&(u=l.attr("data-src")||l.attr("src")||l.attr("data-lazy-src")||a.defaultCover),c.push({name:n,cover:u,path:o.replace(f.site,"/")})}}));return c.length>0?[2,{value:c.slice(0,20)}]:[3,3];case 2:return e.sent(),[2,"continue"];case 3:return[2]}}))},c=0,u=t,p.label=1;case 1:return c<u.length?(l=u[c],[5,s(l)]):[3,4];case 2:if("object"==typeof(h=p.sent()))return[2,h.value];p.label=3;case 3:return c++,[3,1];case 4:return[2,this.popularNovels(o,{showLatestNovels:!1})]}}))}))},o}();exports.default=new o;