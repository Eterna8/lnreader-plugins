var e=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(a,n){function i(e){try{c(s.next(e))}catch(e){n(e)}}function o(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,s,a,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(n=0)),n;)try{if(r=1,s&&(a=2&o[0]?s.return:o[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,o[1])).done)return a;switch(s=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,s=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(!(a=n.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){n=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){n.label=o[1];break}if(6===o[0]&&n.label<a[1]){n.label=a[1],a=o;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(o);break}a[2]&&n.ops.pop(),n.trys.pop();continue}o=t.call(e,n)}catch(e){o=[6,e],s=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),s=require("@libs/fetch"),a=require("@libs/defaultCover"),n=require("@libs/novelStatus"),i=function(){function i(){var e=this;this.id="readhive",this.name="ReadHive",this.icon="src/en/readhive/readhive.jpg",this.site="https://readhive.org/",this.version="1.0.3",this.filters=[],this.resolveUrl=function(t){try{return new URL(t,e.site).toString()}catch(r){return e.site+t}}}return i.prototype.popularNovels=function(n,i){return e(this,void 0,void 0,(function(){var e,n,i,o,c,l,h,u=this;return t(this,(function(t){switch(t.label){case 0:e=[],t.label=1;case 1:return t.trys.push([1,4,,5]),n=this.site+"/",[4,(0,s.fetchApi)(n)];case 2:if(!(i=t.sent()).ok)throw new Error("HTTP ".concat(i.status));return[4,i.text()];case 3:return o=t.sent(),c=(0,r.load)(o),c(".series-card, .series-item, .novel-card, .post, .card").slice(0,40).each((function(t,r){var s=c(r).find('a[href*="/series/"]').first();if(s&&s.attr("href")){var n=u.resolveUrl(s.attr("href")),i=(s.text()||c(r).find("h2, h3, .title").text()||"").trim(),o=c(r).find("img").first(),l=(null==o?void 0:o.attr("src"))?u.resolveUrl(o.attr("src")):a.defaultCover;e.push({name:i||n,path:n.replace(u.site,"/"),cover:l||a.defaultCover})}})),e.length||(l=new Set,c('a[href*="/series/"]').each((function(t,r){var s=c(r).attr("href")||"",n=u.resolveUrl(s);if(!l.has(n)){l.add(n);var i=(c(r).text()||"").trim()||n;e.push({name:i,path:n.replace(u.site,"/"),cover:a.defaultCover})}}))),[3,5];case 4:return h=t.sent(),console.warn("ReadHive popularNovels error",h),[3,5];case 5:return[2,e]}}))}))},i.prototype.searchNovels=function(n,i){return e(this,void 0,void 0,(function(){var e,i,o,c,l,h,u,f,p=this;return t(this,(function(t){switch(t.label){case 0:e=[],t.label=1;case 1:return t.trys.push([1,4,,5]),i="".concat(this.site,"/?s=").concat(encodeURIComponent(n)),[4,(0,s.fetchApi)(i)];case 2:if(!(o=t.sent()).ok)throw new Error("HTTP ".concat(o.status));return[4,o.text()];case 3:return c=t.sent(),l=(0,r.load)(c),(h=l(".series-card, .series-item, .novel-card, .post, .card")).length?h.each((function(t,r){var s=l(r).find('a[href*="/series/"]').first();if(s&&s.attr("href")){var n=p.resolveUrl(s.attr("href")),i=(s.text()||l(r).find("h2, h3, .title").text()||"").trim(),o=l(r).find("img").first(),c=(null==o?void 0:o.attr("src"))?p.resolveUrl(o.attr("src")):a.defaultCover;e.push({name:i||n,path:n.replace(p.site,"/"),cover:c||a.defaultCover})}})):(u=new Set,l('a[href*="/series/"]').each((function(t,r){var s=l(r).attr("href")||"",n=p.resolveUrl(s);if(!u.has(n)){u.add(n);var i=(l(r).text()||"").trim()||n;e.push({name:i,path:n.replace(p.site,"/"),cover:a.defaultCover})}}))),[3,5];case 4:return f=t.sent(),console.warn("ReadHive searchNovels error",f),[3,5];case 5:return[2,e]}}))}))},i.prototype.parseNovel=function(i){return e(this,void 0,void 0,(function(){function e(e){var t=e.match(/\/(\d+(?:\.\d+)?)(?:\/)?$/);if(t)return Number(t[1]);var r=e.match(/v\d+\/(\d+(?:\.\d+)?)/);return r?Number(r[1]):null}var o,c,l,h,u,f,p,v,d,m,b,g,y,w,x,U,C,N,k,T,S,H,R,P,_,E,j,q,A=this;return t(this,(function(t){switch(t.label){case 0:o={path:i,name:"Untitled",cover:a.defaultCover,chapters:[]},t.label=1;case 1:return t.trys.push([1,4,,5]),c=this.resolveUrl(i),[4,(0,s.fetchApi)(c)];case 2:if(!(l=t.sent()).ok)throw new Error("HTTP ".concat(l.status));return[4,l.text()];case 3:for(h=t.sent(),u=(0,r.load)(h),(f=u("h1.series-title, h1, .series-title, .post-title, .entry-title").first().text().trim())&&(o.name=f),(p=u("img.cover, img.series-cover, .cover img, .post-thumbnail img").first().attr("src")||null)||(p=u('meta[property="og:image"]').attr("content")||null),p&&(o.cover=this.resolveUrl(p)),v="",d=0,m=".series-synopsis, .summary, .desc, .description, .entry-summary, .post-excerpt".split(",");d<m.length;d++)if(k=m[d],b=u(k.trim()).first().text().trim()){v=b;break}for(v||(v=u('meta[name="description"]').attr("content")||""),v&&(o.summary=v),(g=u(".status, .series-status, .novel-status").first().text().trim().toLowerCase()).includes("complete")||g.includes("completed")?o.status=n.NovelStatus.Completed:g&&(o.status=n.NovelStatus.Ongoing),(y=u(".genres, .tags, .series-genres, .post-tags").first().text().trim())&&(o.genres=y),(w=u(".author, .series-author, .post-author").first().text().trim())&&(o.author=w),x=[],U=!1,C=0,N=["#releases",".releases","#chapter-list",".chapter-list",".chapters",".series-chapters",".list-chapters",".post-content"];C<N.length;C++)if((T=u(k=N[C]))&&T.length&&(T.find("a[href]").each((function(e,t){var r=u(t),s=r.attr("href")||"";if(s){var a=A.resolveUrl(s);if(a.includes("/series/")){var n=(r.text()||r.attr("title")||"").trim()||a;x.push({name:n,path:a.replace(A.site,"/"),releaseTime:"",chapterNumber:0})}}})),x.length)){U=!0;break}for(U||(S=new Set,u('a[href*="/series/"]').each((function(e,t){var r=u(t),s=r.attr("href")||"",a=A.resolveUrl(s);if(a.match(/\/series\/\d+\/(.+)?/)&&a.replace(/\/+$/,"")!==c.replace(/\/+$/,"")&&!S.has(a)){S.add(a);var n=(r.text()||r.attr("title")||"").trim()||a;x.push({name:n,path:a.replace(A.site,"/"),releaseTime:"",chapterNumber:0})}}))),H=[],R=new Set,P=0,_=x;P<_.length;P++)E=_[P],R.has(E.path)||(R.add(E.path),H.push(E));for(H.sort((function(t,r){var s=e(t.path),a=e(r.path);return null!==s&&null!==a?s-a:null!==s?-1:null!==a?1:t.name.localeCompare(r.name)})),j=0;j<H.length;j++)H[j].chapterNumber=j+1;return o.chapters=H,[3,5];case 4:return q=t.sent(),console.error("ReadHive parseNovel error",q),o.chapters=o.chapters||[],[3,5];case 5:return[2,o]}}))}))},i.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e,n,i,o,c,l,h,u,f,p,v,d,m,b=this;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e=this.resolveUrl(a),[4,(0,s.fetchApi)(e)];case 1:if(!(n=t.sent()).ok)throw new Error("HTTP ".concat(n.status));return[4,n.text()];case 2:for(i=t.sent(),o=(0,r.load)(i),c=o("h1.chapter-title, .chapter-title, h1, .post-title").first().text().trim(),l="",h=0,u=[".chapter-content",".entry-content",".post-content",".reader-content","#chapter-content",".content","article"];h<u.length;h++)if((f=o(u[h]).first())&&f.text().trim().length>50){l=f.html()||"";break}return l||(p="",v=0,o("div, section, article").each((function(e,t){var r=o(t).text()||"";r.length>v&&(v=r.length,p=o(t).html()||"")})),l=p),l?((d=(0,r.load)(l))("script, iframe, .share, .shares, .ads, .advert, .toc, .nav, .comments, style, noscript, .related").remove(),d("p").each((function(e,t){0===(d(t).text()||"").trim().length&&d(t).remove()})),d("img").each((function(e,t){var r=d(t).attr("src")||d(t).attr("data-src")||"";r&&d(t).attr("src",b.resolveUrl(r))})),[2,"<h1>".concat(c||"","</h1>\n").concat(d.html()||"")]):[2,""];case 3:return m=t.sent(),console.error("ReadHive parseChapter error",m),[2,""];case 4:return[2]}}))}))},i}();exports.default=new i;