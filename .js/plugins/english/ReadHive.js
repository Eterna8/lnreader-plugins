var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,a){function s(t){try{c(n.next(t))}catch(t){a(t)}}function o(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("cheerio"),i=require("@libs/defaultCover"),a=require("@libs/novelStatus"),s=function(){function s(){var t=this;this.id="readhive",this.name="ReadHive",this.icon="src/en/readhive/readhive.jpg",this.site="https://readhive.org/",this.version="1.0.0",this.resolveUrl=function(e,r){return e.startsWith("http")?e:t.site+e.replace(/^\//,"")}}return s.prototype.popularNovels=function(a,s){return t(this,arguments,void 0,(function(t,a){var s,o,c,u,h,l=this;a.showLatestNovels;return e(this,(function(t){switch(t.label){case 0:return s="".concat(this.site),[4,(0,r.fetchApi)(s).then((function(t){return t.text()}))];case 1:return o=t.sent(),c=(0,n.load)(o),u=[],h=new Set,c('a[href*="/series/"]').each((function(t,e){var r=c(e).attr("href");if(r&&!h.has(r)){h.add(r);var n="",a=c(e).closest("[x-text], [title], .font-bold");if(!(n=a.attr("x-text")||a.attr("title")||a.text().trim())){var s=r.match(/\/series\/(\d+)/);s&&(n="Series ".concat(s[1]))}var o=i.defaultCover,f=c(e).find("img").first();f.length&&(o=f.attr("src")||f.attr("data-src")||f.attr(":src")||i.defaultCover)&&!o.startsWith("http")&&(o=l.site+o),n&&r&&u.push({name:n,cover:o,path:r.replace(l.site,"/")})}})),[2,u.filter((function(t,e,r){return e===r.findIndex((function(e){return e.path===t.path}))})).slice(0,20)]}}))}))},s.prototype.parseNovel=function(s){return t(this,void 0,void 0,(function(){var t,o,c,u,h,l,f,p,v,d,m,b,x=this;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site).concat(s.replace(/^\//,""),"#about"),[4,(0,r.fetchApi)(t).then((function(t){return t.text()}))];case 1:o=e.sent(),c=(0,n.load)(o),u={path:s,name:c(".series-title").text().trim()||c("h1").first().text().trim()},h=c(".series-cover img"),u.cover=h.attr("data-src")||h.attr("src")||i.defaultCover,u.cover&&!u.cover.startsWith("http")&&(u.cover=this.site+u.cover),u.author=c(".series-author").text().trim()||"",l=c(".series-status").text().trim().toLowerCase(),u.status=l.includes("ongoing")||l.includes("active")?a.NovelStatus.Ongoing:a.NovelStatus.Completed,u.genres=c(".series-genres a").map((function(t,e){return c(e).text().trim()})).get().join(", "),u.summary=c(".series-synopsis").text().trim()||"",f=[],e.label=2;case 2:return e.trys.push([2,4,,5]),p="".concat(this.site).concat(s.replace(/^\//,""),"#releases"),[4,(0,r.fetchApi)(p).then((function(t){return t.text()}))];case 3:return v=e.sent(),d=(0,n.load)(v),m=0,d(".chapter-list .chapter-item").each((function(t,e){var r=d(e).find(".chapter-title").text().trim(),n=d(e).find("a").attr("href"),i=d(e).find(".volume-title").text().trim();r&&n&&(m++,f.push({name:i?"".concat(i," - ").concat(r):r,path:n.replace(x.site,"/"),releaseTime:null,chapterNumber:m}))})),[3,5];case 4:return b=e.sent(),console.warn("Could not fetch chapters from releases page:",b),[3,5];case 5:return u.chapters=f.reverse(),[2,u]}}))}))},s.prototype.parseChapter=function(i){return t(this,void 0,void 0,(function(){var t,a,s,o,c,u,h;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site).concat(i.replace(/^\//,"")),[4,(0,r.fetchApi)(t).then((function(t){return t.text()}))];case 1:for(a=e.sent(),s=(0,n.load)(a),o=0,c=[".chapter-content",".chapter-body",".novel-content",".post-content",".entry-content","#chapter-content"];o<c.length;o++)if((u=s(c[o])).length>0)return u.find("script, style, .ads, .advertisement, .chapter-nav, .navigation, .pager").remove(),[2,u.html()||""];return(h=s("main .content, .main-content, .story-content")).length>0?(h.find("script, style, nav, .nav, .navigation").remove(),[2,h.html()||""]):[2,s("body").html()||""]}}))}))},s.prototype.searchNovels=function(a,s){return t(this,void 0,void 0,(function(){var t,o,c,u,h,l,f=this;return e(this,(function(p){switch(p.label){case 0:t=["".concat(this.site,"?s=").concat(encodeURIComponent(a)),"".concat(this.site,"search?q=").concat(encodeURIComponent(a)),"".concat(this.site,"browse-series/")],o=function(t){var s,o,c,u;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,r.fetchApi)(t).then((function(t){return t.text()}))];case 1:return(s=e.sent())&&""!==s.trim()?(o=(0,n.load)(s),c=[],o('a[href*="/series/"]').each((function(e,r){var n,s=o(r).attr("href");if(s){var u="",h=o(r).closest("[x-text], [title], .font-bold, h1, h2, h3, h4, h5, h6");if(u=h.attr("x-text")||h.attr("title")||h.text().trim()||o(r).text().trim(),(t.includes("search")||t.includes("s="))&&u&&!u.toLowerCase().includes(a.toLowerCase())){var l=s.match(/\/series\/(\d+)/);if(!l||!l[1].includes(a))return}var p=i.defaultCover,v=o(r).find("img").first();v.length&&(p=v.attr("src")||v.attr("data-src")||v.attr(":src")||i.defaultCover)&&!p.startsWith("http")&&(p=f.site+p),s&&c.push({name:u||"Series ".concat((null===(n=s.match(/\/series\/(\d+)/))||void 0===n?void 0:n[1])||e),cover:p,path:s.replace(f.site,"/")})}})),(u=c.filter((function(t,e,r){return e===r.findIndex((function(e){return e.path===t.path}))})).slice(0,20)).length>0?[2,{value:u}]:[3,3]):[2,"continue"];case 2:return e.sent(),[2,"continue"];case 3:return[2]}}))},c=0,u=t,p.label=1;case 1:return c<u.length?(h=u[c],[5,o(h)]):[3,4];case 2:if("object"==typeof(l=p.sent()))return[2,l.value];p.label=3;case 3:return c++,[3,1];case 4:return[2,this.popularNovels(s,{showLatestNovels:!1})]}}))}))},s}();exports.default=new s;