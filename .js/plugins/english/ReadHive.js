var t=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))((function(n,s){function i(t){try{c(a.next(t))}catch(t){s(t)}}function o(t){try{c(a.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}c((a=a.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,a,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};define("ReadHive",["require","exports","@libs/fetch","cheerio","@libs/defaultCover","@libs/novelStatus"],(function(r,a,n,s,i,o){Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function r(){var t=this;this.id="readhive",this.name="ReadHive",this.icon="src/en/readhive/icon.png",this.site="https://readhive.org",this.version="1.0.5",this.filters=void 0,this.resolveUrl=function(e,r){return t.site+e}}return r.prototype.popularNovels=function(r,a){return t(this,arguments,void 0,(function(t,r){var a,o,c,h,l,u,f,p=this;r.showLatestNovels,r.filters;return e(this,(function(t){switch(t.label){case 0:a=[],t.label=1;case 1:return t.trys.push([1,4,,5]),o=this.site+"/",[4,(0,n.fetchApi)(o)];case 2:if(!(c=t.sent()).ok)throw new Error("HTTP ".concat(c.status));return[4,c.text()];case 3:return h=t.sent(),l=(0,s.load)(h),u=new Set,l('a[href*="/series/"]').each((function(t,e){var r=l(e).attr("href");if(r){var n=r.match(/\/series\/(\d+)\/?$/);if(n){var s=n[1],o="/series/".concat(s,"/");if(!u.has(o)){u.add(o);var c=l(e).text().trim();(!c||c.length<2)&&(c=l(e).closest(".series-card, .novel-card, .card, .item").find("h2, h3, .title, .name").first().text().trim()),(!c||c.length<2)&&(c="Series ".concat(s));var h=i.defaultCover,f=l(e).find("img").first();if(f.length){(d=f.attr("src")||f.attr("data-src"))&&(h=d.startsWith("http")?d:p.site+d)}else{var d,v=l(e).closest(".series-card, .novel-card, .card, .item").find("img").first();if(v.length)(d=v.attr("src")||v.attr("data-src"))&&(h=d.startsWith("http")?d:p.site+d)}a.push({name:c,path:o,cover:h})}}}})),[2,a.slice(0,40)];case 4:return f=t.sent(),console.error("ReadHive popularNovels error:",f),[3,5];case 5:return[2,a]}}))}))},r.prototype.parseNovel=function(r){return t(this,void 0,void 0,(function(){var t,a,c,h,l,u,f,p,d,v,m,g,y,b,w,x=this;return e(this,(function(e){switch(e.label){case 0:t={path:r,name:"Untitled",cover:i.defaultCover,chapters:[]},e.label=1;case 1:return e.trys.push([1,4,,5]),a=this.site+r,[4,(0,n.fetchApi)(a)];case 2:if(!(c=e.sent()).ok)throw new Error("HTTP ".concat(c.status));return[4,c.text()];case 3:return h=e.sent(),l=(0,s.load)(h),(u=l("h1, h2").first().text().trim())||(u=l('meta[property="og:title"]').attr("content")||""),u&&(t.name=u),(f=l("img").first().attr("src")||l("img").first().attr("data-src"))||(f=l('meta[property="og:image"]').attr("content")),f&&(t.cover=f.startsWith("http")?f:this.site+f),p=l("body").text(),(d=p.match(/Author[:\s]+([^\n]+)/i)||p.match(/By[:\s]+([^\n]+)/i))&&(t.author=d[1].trim()),(v=l(".synopsis, .summary, p").filter((function(t,e){return l(e).text().length>100})).first()).length&&(t.summary=v.text().trim()),(m=l("body").text().toLowerCase()).includes("completed")||m.includes("complete")?t.status=o.NovelStatus.Completed:(m.includes("ongoing")||m.includes("updating"))&&(t.status=o.NovelStatus.Ongoing),g=[],l('a[href*="/tag/"], .tag, .genre').each((function(t,e){var r=l(e).text().trim();r&&r.length>0&&g.push(r)})),g.length>0&&(t.genres=g.join(", ")),y=[],b=new Set,l('a[href*="/series/"]').each((function(t,e){var r=l(e).attr("href");if(r){var a=r.match(/\/series\/\d+\/(v\d+)\/([^\/]+)\/?$/);if(a){var n=r.replace(x.site,"");if(!b.has(n)){b.add(n);var s=l(e).text().trim();(!s||s.length<2)&&(s=l(e).closest("li, .chapter, .item").text().trim().split("\n")[0].trim()),(!s||s.length<2)&&(s="".concat(a[1]," Ch ").concat(a[2]));var i="",o=l(e).closest("li, .chapter, .item").find("time, .date, .time, small").first();o.length&&(i=o.text().trim()),y.push({name:s,path:n,releaseTime:i,chapterNumber:0})}}}})),y.sort((function(t,e){var r=t.path.match(/v(\d+)\/([^\/]+)/),a=e.path.match(/v(\d+)\/([^\/]+)/);if(!r||!a)return 0;var n=parseInt(r[1]),s=parseInt(a[1]);return n!==s?n-s:parseFloat(r[2])-parseFloat(a[2])})),y.forEach((function(t,e){t.chapterNumber=e+1})),t.chapters=y,[3,5];case 4:return w=e.sent(),console.error("ReadHive parseNovel error:",w),[3,5];case 5:return[2,t]}}))}))},r.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var t,a,i,o,c,h,l,u,f,p,d,v,m=this;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),t=this.site+r,[4,(0,n.fetchApi)(t)];case 1:if(!(a=e.sent()).ok)throw new Error("HTTP ".concat(a.status));return[4,a.text()];case 2:for(i=e.sent(),o=(0,s.load)(i),c=o("h1, h2").first().text().trim(),h="",l=0,u=[".chapter-content",".content",".entry-content","article","main"];l<u.length;l++)if((f=o(u[l]).first()).length&&f.text().trim().length>50){h=f.html()||"";break}return h||(p=0,o("div, section, article").each((function(t,e){var r=o(e).text();r.length>p&&r.length>100&&(p=r.length,h=o(e).html()||"")}))),h?((d=(0,s.load)(h))("script, style, iframe, .ads, .ad, .advertisement, nav, .nav, .share, .comments").remove(),d("img").each((function(t,e){var r=d(e).attr("src")||d(e).attr("data-src");r&&!r.startsWith("http")&&d(e).attr("src",m.site+r)})),[2,"<h1>".concat(c,"</h1>\n").concat(d.html())]):[2,"<p>Chapter content not found</p>"];case 3:return v=e.sent(),console.error("ReadHive parseChapter error:",v),[2,"<p>Error loading chapter</p>"];case 4:return[2]}}))}))},r.prototype.searchNovels=function(r,a){return t(this,void 0,void 0,(function(){var t,a,o,c,h,l,u,f=this;return e(this,(function(e){switch(e.label){case 0:t=[],e.label=1;case 1:return e.trys.push([1,4,,5]),a="".concat(this.site,"/?s=").concat(encodeURIComponent(r)),[4,(0,n.fetchApi)(a)];case 2:if(!(o=e.sent()).ok)throw new Error("HTTP ".concat(o.status));return[4,o.text()];case 3:return c=e.sent(),h=(0,s.load)(c),l=new Set,h('a[href*="/series/"]').each((function(e,r){var a=h(r).attr("href");if(a){var n=a.match(/\/series\/(\d+)\/?$/);if(n){var s=n[1],o="/series/".concat(s,"/");if(!l.has(o)){l.add(o);var c=h(r).text().trim();(!c||c.length<2)&&(c=h(r).closest(".series-card, .novel-card, .card, .item").find("h2, h3, .title, .name").first().text().trim()),(!c||c.length<2)&&(c="Series ".concat(s));var u=i.defaultCover,p=h(r).find("img").first();if(p.length){(d=p.attr("src")||p.attr("data-src"))&&(u=d.startsWith("http")?d:f.site+d)}else{var d,v=h(r).closest(".series-card, .novel-card, .card, .item").find("img").first();if(v.length)(d=v.attr("src")||v.attr("data-src"))&&(u=d.startsWith("http")?d:f.site+d)}t.push({name:c,path:o,cover:u})}}}})),[2,t];case 4:return u=e.sent(),console.error("ReadHive searchNovels error:",u),[3,5];case 5:return[2,t]}}))}))},r}();a.default=new c}));