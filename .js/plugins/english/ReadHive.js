var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("cheerio"),o=require("@libs/defaultCover"),i=function(){function i(){var e=this;this.id="readhive",this.name="ReadHive",this.icon="src/en/readhive/FO721D5FA0CC7-02-scaled-e1658075230203-150x150.jpg",this.site="https://readhive.org",this.version="2.0.0",this.filters=void 0,this.resolveUrl=function(t){return t.startsWith("http")?t:e.site+(t.startsWith("/")?t:"/"+t)}}return i.prototype.popularNovels=function(i,s){return e(this,void 0,void 0,(function(){var e,a,l,c,u,h=this;return t(this,(function(t){switch(t.label){case 0:return i>1?[2,[]]:(e=this.site,[4,(0,r.fetchApi)(e)]);case 1:return[4,t.sent().text()];case 2:return a=t.sent(),l=(0,n.load)(a),c=[],u=new Set,s.showLatestNovels?l('h2:contains("Latest Updates")').next(".flex-wrap").find(".px-2.mb-4").each((function(e,t){var r=l(t).find("a.peer").attr("href");if(r&&!u.has(r)){var n=l(t).find("a.text-lg").text().trim(),i=l(t).find("img").attr("src");i&&!i.startsWith("http")&&(i=h.resolveUrl(i)),c.push({name:n,path:r,cover:i||o.defaultCover}),u.add(r)}})):l('h2:contains("Popular")').nextAll(".swiper").find(".swiper-slide").each((function(e,t){var r=l(t).find("a").attr("href");if(r&&!u.has(r)){var n=l(t).find("h6").text().trim(),i=l(t).find("img").attr("src");i&&!i.startsWith("http")&&(i=h.resolveUrl(i)),c.push({name:n,path:r,cover:i||o.defaultCover}),u.add(r)}})),[2,c]}}))}))},i.prototype.searchNovels=function(o,i){return e(this,void 0,void 0,(function(){var e,s,a,l,c,u,h,f,p=this;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),console.log("=== SEARCH DEBUG START ==="),console.log("Search term:",o),console.log("Page:",i),e="".concat(this.site,"/wp-json/wp/v2/posts?search=").concat(encodeURIComponent(o),"&per_page=20&page=").concat(i),console.log("Making WordPress API request to:",e),[4,(0,r.fetchApi)(e)];case 1:return s=t.sent(),console.log("Response status:",s.status),[4,s.text()];case 2:a=t.sent(),console.log("Response type:","string"==typeof a?"text":"other"),l=void 0;try{l=JSON.parse(a),console.log("Successfully parsed JSON response")}catch(e){return console.log("Failed to parse JSON as WordPress API, falling back to HTML parsing"),c=(0,n.load)(a),u=[],c("article").each((function(e,t){var r=c(t).find("h1, h2, h3").first(),n=c(t).find("a").first(),o=c(t).find("img").first();if(r&&n&&o){var i=r.text().trim(),s=n.attr("href"),a=o.attr("src");if(i&&s&&s.includes("/series/")){var l={name:i,path:s.replace(p.site,""),cover:a&&a.startsWith("http")?a:p.resolveUrl(a)};u.push(l),console.log("Found novel via HTML fallback:",i)}}})),console.log("=== SEARCH DEBUG END ==="),console.log("Returning",u.length,"novels"),[2,u]}return h=[],Array.isArray(l)&&l.forEach((function(e){if(e.link&&e.title&&e.link.includes("/series/")){var t={name:e.title.rendered||e.title.raw||e.title,path:e.link.replace(p.site,""),cover:e.featured_media&&e.featured_media.source_url?e.featured_media.source_url:""};h.push(t),console.log("Found novel via JSON:",t.name)}})),console.log("Total novels found:",h.length),console.log("=== SEARCH DEBUG END ==="),[2,h];case 3:return f=t.sent(),console.error("=== SEARCH ERROR ==="),console.error("Error:",f),console.error("Error message:",f instanceof Error?f.message:"Unknown error"),[2,[]];case 4:return[2]}}))}))},i.prototype.parseNovel=function(i){return e(this,void 0,void 0,(function(){var e,s,a,l,c,u,h,f,p=this;return t(this,(function(t){switch(t.label){case 0:return e=this.resolveUrl(i),[4,(0,r.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return s=t.sent(),a=(0,n.load)(s),l=a('h1[class*="line-clamp-4"]').text().trim(),c=a('img[alt*="Cover"]').attr("src")||a('img[class*="object-cover"]').attr("src")||o.defaultCover,u={path:i,name:l,cover:this.resolveUrl(c),author:a('span[class*="leading-7"]').text().trim(),summary:a('h2:contains("Synopsis")').next("div").find("p").text().trim(),genres:a('div.lg\\:grid-in-info a[href*="/genre/"]').map((function(e,t){return a(t).text()})).get().join(", "),chapters:[]},h=a('div.grid-cols-1 a[href*="/series/"]'),f=h.map((function(e,t){var r=a(t).attr("href");if(!r)return null;var n=a(t).find('span[class*="ml-1"]').text().trim(),o=a(t).find("span.text-xs").text().trim();return{name:n,path:r.replace(p.site,""),releaseTime:o}})).get().filter(Boolean),u.chapters=f.reverse(),[2,u]}}))}))},i.prototype.parseChapter=function(o){return e(this,void 0,void 0,(function(){var e,i,s,a;return t(this,(function(t){switch(t.label){case 0:return e=this.resolveUrl(o),[4,(0,r.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return i=t.sent(),s=(0,n.load)(i),(a=s('div[class*="lg:grid-in-content"] div[style*="font-size"]')).find("div[data-fuse]").remove(),a.find("div.socials").remove(),a.find("div.reader-settings").remove(),a.find("div.nav-wrapper").remove(),a.find('p:contains("• • •")').remove(),a.find("p").each((function(e,t){var r,n;"&nbsp;"!==(null===(r=s(t).html())||void 0===r?void 0:r.trim())&&""!==(null===(n=s(t).html())||void 0===n?void 0:n.trim())||s(t).remove()})),[2,a.html()||""]}}))}))},i}();exports.default=new i;